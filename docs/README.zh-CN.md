# vite-plugin-network-mock

ä¸€ä¸ªç”¨äºç›‘æ§ç½‘ç»œè¯·æ±‚å¹¶æä¾›å†…ç½® Mock åŠŸèƒ½çš„ Vite æ’ä»¶ã€‚æä¾›å¯è§†åŒ–é¢æ¿ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­å®æ—¶æ£€æŸ¥ API è¯·æ±‚å¹¶åŠ¨æ€åˆ›å»º Mock è§„åˆ™ã€‚

[English](../README.md)

## æˆªå›¾é¢„è§ˆ

| ç½‘ç»œç›‘æ§ | Mock è§„åˆ™ | Mock.js å‚è€ƒ |
|:---:|:---:|:---:|
| ![ç½‘ç»œç›‘æ§](./images/network.png) | ![Mock è§„åˆ™](./images/rules.png) | ![Mock å‚è€ƒ](./images/mock-reference.png) |

## ç‰¹æ€§

- ğŸ” å®æ—¶ç½‘ç»œè¯·æ±‚ç›‘æ§
- ğŸ­ æ— éœ€ä¿®æ”¹ä»£ç å³å¯åŠ¨æ€åˆ›å»º Mock è§„åˆ™
- ğŸ“Š å¯è§†åŒ–é¢æ¿æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…
- ğŸ’¾ Mock è§„åˆ™æŒä¹…åŒ–å­˜å‚¨ï¼Œé‡å¯å¼€å‘æœåŠ¡å™¨åä¾ç„¶æœ‰æ•ˆ
- â±ï¸ æ”¯æŒå“åº”å»¶è¿Ÿæ¨¡æ‹Ÿ
- ğŸ”„ åŸºäº WebSocket çš„å®æ—¶æ›´æ–°
- ğŸ² é›†æˆ Mock.jsï¼Œæ”¯æŒç”Ÿæˆéšæœºæ•°æ®
- ğŸ“ æ”¯æŒè‡ªå®šä¹‰å“åº”å¤´
- ğŸ” è¯·æ±‚/å“åº”ä½“é¢„è§ˆï¼Œæ”¯æŒè¯­æ³•é«˜äº®
- ğŸ·ï¸ æ”¯æŒæŒ‰æ–¹æ³•ã€URLã€Mock çŠ¶æ€ç­›é€‰æ—¥å¿—
- âš¡ ä¸€é”®ä»æ•è·çš„è¯·æ±‚åˆ›å»º Mock è§„åˆ™

## å®‰è£…

```bash
npm install vite-plugin-network-mock --save-dev
# æˆ–
yarn add vite-plugin-network-mock -D
# æˆ–
pnpm add vite-plugin-network-mock -D
```

## ä½¿ç”¨æ–¹æ³•

### åŸºç¡€é…ç½®

```ts
// vite.config.ts
import { defineConfig } from 'vite'
import networkMock from 'vite-plugin-network-mock'

export default defineConfig({
  plugins: [
    networkMock()
  ]
})
```

### å®Œæ•´é…ç½®

```ts
// vite.config.ts
import { defineConfig } from 'vite'
import networkMock from 'vite-plugin-network-mock'

export default defineConfig({
  plugins: [
    networkMock({
      enabled: true,                    // æ˜¯å¦å¯ç”¨æ’ä»¶
      panelPath: '/__network_mock__',   // é¢æ¿è®¿é—®è·¯å¾„
      include: ['/api/', '/prod-api/'], // éœ€è¦æ‹¦æˆªçš„ URL æ¨¡å¼
      exclude: ['/__', '/@']            // éœ€è¦å¿½ç•¥çš„ URL æ¨¡å¼
    })
  ]
})
```

### è®¿é—®é¢æ¿

å¯åŠ¨å¼€å‘æœåŠ¡å™¨åï¼Œè®¿é—®ï¼š

```
http://localhost:5173/__network_mock__
```

## é…ç½®é€‰é¡¹

| é€‰é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `enabled` | `boolean` | `true` | æ˜¯å¦å¯ç”¨æ’ä»¶ |
| `panelPath` | `string` | `'/__network_mock__'` | Mock é¢æ¿çš„è®¿é—®è·¯å¾„ |
| `include` | `string[]` | `['/api/', '/prod-api/']` | éœ€è¦ç›‘æ§å’Œ Mock çš„ URL æ¨¡å¼ |
| `exclude` | `string[]` | `['/__', '/@', '/node_modules/', ...]` | éœ€è¦å¿½ç•¥çš„ URL æ¨¡å¼ |

## Mock è§„åˆ™å±æ€§

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `url` | `string` | è¦åŒ¹é…çš„ URL æ¨¡å¼ï¼ˆå­å­—ç¬¦ä¸²åŒ¹é…ï¼‰ |
| `method` | `string` | HTTP æ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETE ç­‰ï¼‰ |
| `status` | `number` | è¿”å›çš„ HTTP çŠ¶æ€ç  |
| `delay` | `number` | å“åº”å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| `response` | `any` | Mock å“åº”ä½“ï¼ˆJSON æ ¼å¼ï¼Œæ”¯æŒ Mock.js è¯­æ³•ï¼‰ |
| `headers` | `object` | è‡ªå®šä¹‰å“åº”å¤´ |
| `enabled` | `boolean` | æ˜¯å¦å¯ç”¨æ­¤è§„åˆ™ |

## Mock.js æ”¯æŒ

æœ¬æ’ä»¶é›†æˆäº† [Mock.js](http://mockjs.com/)ï¼Œæ”¯æŒç”Ÿæˆéšæœº Mock æ•°æ®ã€‚ä½ å¯ä»¥åœ¨å“åº”ä½“ä¸­ä½¿ç”¨ Mock.js è¯­æ³•ï¼š

```json
{
  "code": 200,
  "data": {
    "list|10": [{
      "id": "@id",
      "name": "@cname",
      "email": "@email",
      "avatar": "@image('100x100')",
      "createTime": "@datetime"
    }],
    "total": "@integer(100, 500)"
  }
}
```

å¸¸ç”¨ Mock.js å ä½ç¬¦ï¼š
- `@id` - éšæœº ID
- `@name` / `@cname` - è‹±æ–‡/ä¸­æ–‡å§“å
- `@email` - é‚®ç®±åœ°å€
- `@datetime` - æ—¥æœŸæ—¶é—´
- `@image` - å ä½å›¾ç‰‡ URL
- `@integer(min, max)` - éšæœºæ•´æ•°
- `@string(length)` - éšæœºå­—ç¬¦ä¸²
- `@boolean` - éšæœºå¸ƒå°”å€¼
- `@paragraph` / `@cparagraph` - è‹±æ–‡/ä¸­æ–‡æ®µè½

é¢æ¿å†…ç½®äº† Mock.js è¯­æ³•å‚è€ƒæŒ‡å—ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥é˜…ã€‚

## å®ç°åŸç†

### æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Vite å¼€å‘æœåŠ¡å™¨                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ä¸­é—´ä»¶     â”‚â”€â”€â”€â–¶â”‚ Mock å­˜å‚¨   â”‚â—€â”€â”€â”€â”‚  WebSocket      â”‚  â”‚
â”‚  â”‚  æ‹¦æˆªå™¨     â”‚    â”‚ ï¼ˆæŒä¹…åŒ–ï¼‰   â”‚    â”‚  æœåŠ¡å™¨         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                      â–²            â”‚
â”‚         â–¼                                      â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   è¯·æ±‚      â”‚                      â”‚   Mock é¢æ¿     â”‚   â”‚
â”‚  â”‚   å“åº”      â”‚                      â”‚   ï¼ˆæµè§ˆå™¨ï¼‰    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

1. **ä¸­é—´ä»¶æ‹¦æˆªå™¨**ï¼šæ‹¦æˆªåŒ¹é… `include` æ¨¡å¼çš„ HTTP è¯·æ±‚ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…çš„ Mock è§„åˆ™ã€‚

2. **Mock å­˜å‚¨**ï¼šç®¡ç† Mock è§„åˆ™å’Œç½‘ç»œæ—¥å¿—ï¼Œä½¿ç”¨æ–‡ä»¶ç³»ç»ŸæŒä¹…åŒ–å­˜å‚¨åœ¨ `~/.vite-network-mock/<é¡¹ç›®å“ˆå¸Œ>/` ç›®å½•ã€‚

3. **WebSocket æœåŠ¡å™¨**ï¼šå®ç°é¢æ¿ä¸æ’ä»¶ä¹‹é—´çš„å®æ—¶é€šä¿¡ï¼Œç¡®ä¿å³æ—¶æ›´æ–°ã€‚

4. **é¢æ¿ UI**ï¼šå†…ç½®çš„ HTML é¡µé¢ï¼Œç”¨äºæŸ¥çœ‹æ—¥å¿—å’Œç®¡ç† Mock è§„åˆ™ã€‚

### è¯·æ±‚å¤„ç†æµç¨‹

1. å®¢æˆ·ç«¯å‘å¼€å‘æœåŠ¡å™¨å‘é€è¯·æ±‚
2. ä¸­é—´ä»¶æ£€æŸ¥ URL æ˜¯å¦åŒ¹é… `include` æ¨¡å¼ï¼ˆä¸”ä¸åœ¨ `exclude` ä¸­ï¼‰
3. å¦‚æœå­˜åœ¨åŒ¹é…çš„å·²å¯ç”¨ Mock è§„åˆ™ï¼š
   - åº”ç”¨é…ç½®çš„å»¶è¿Ÿæ—¶é—´
   - è¿”å›æŒ‡å®šçŠ¶æ€ç çš„ Mock å“åº”
4. å¦‚æœæ²¡æœ‰åŒ¹é…çš„ Mock è§„åˆ™ï¼š
   - å°†è¯·æ±‚è½¬å‘åˆ°å®é™…åç«¯
   - æ•è·å¹¶è®°å½•å“åº”
5. é€šè¿‡ WebSocket å°†æ—¥å¿—æ¡ç›®å¹¿æ’­åˆ°æ‰€æœ‰è¿æ¥çš„é¢æ¿

### æ•°æ®æŒä¹…åŒ–

Mock è§„åˆ™å­˜å‚¨åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼š
```
~/.vite-network-mock/<é¡¹ç›®å“ˆå¸Œ>/
â”œâ”€â”€ rules.json    # Mock è§„åˆ™
â””â”€â”€ logs.json     # ç½‘ç»œæ—¥å¿—ï¼ˆæœ€å¤š 500 æ¡ï¼‰
```

`<é¡¹ç›®å“ˆå¸Œ>` æ˜¯é¡¹ç›®æ ¹è·¯å¾„çš„ MD5 å“ˆå¸Œå€¼ï¼Œç¡®ä¿æ¯ä¸ªé¡¹ç›®æœ‰ç‹¬ç«‹çš„å­˜å‚¨ç©ºé—´ã€‚

## License

MIT
